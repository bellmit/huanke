<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.huanke.iot.base.dao.device.DeviceMapper">

    <sql id="tableName">
        t_device
    </sql>
    <!-- 插入一条记录 -->
    <insert id="insert" useGeneratedKeys="true" keyProperty="id" parameterType="com.huanke.iot.base.po.device.DevicePo">
        INSERT INTO
        <include refid="tableName"/>
        (
        name,
        mac,
        deviceId,
        devicelicence,
        imei,
        imsi,
        saNo,
        typeId,
        modelId,
        productId,
        onlineStatus,
        bindStatus,
        bindTime,
        enableStatus,
        workStatus,
        ip,
        speedConfig,
        version,
        location,
        status,
        hardVersion,
        communicationVersion,
        softVersion,
        birthTime,
        createTime,
        lastUpdateTime
        )
        VALUES
        (
        #{name},
        #{mac},
        #{deviceId},
        #{devicelicence},
        #{imei},
        #{imsi},
        #{saNo},
        #{typeId},
        #{modelId},
        #{productId},
        #{onlineStatus},
        #{bindStatus},
        #{bindTime},
        #{enableStatus},
        #{workStatus},
        #{ip},
        #{speedConfig},
        #{version},
        #{location},
        #{status},
        #{hardVersion},
        #{communicationVersion},
        #{softVersion},
        #{birthTime},
        #{createTime},
        #{lastUpdateTime}
        )
    </insert>

    <!-- 批量插入数条记录 -->
    <insert id="insertBatch"  useGeneratedKeys="true" keyProperty="id" parameterType="List">
        INSERT INTO
        <include refid="tableName"/>
        (
        name,
        mac,
        deviceId,
        devicelicence,
        imei,
        imsi,
        saNo,
        typeId,
        modelId,
        productId,
        onlineStatus,
        bindStatus,
        bindTime,
        enableStatus,
        workStatus,
        ip,
        speedConfig,
        version,
        location,
        status,
        hardVersion,
        communicationVersion,
        softVersion,
        birthTime,
        createTime,
        lastUpdateTime
        )
        VALUES
        <foreach collection="list" item="device" separator=",">
            (
            #{device.name},
            #{device.mac},
            #{device.deviceId},
            #{device.devicelicence},
            #{device.imei},
            #{device.imsi},
            #{device.saNo},
            #{device.typeId},
            #{device.modelId},
            #{device.productId},
            #{device.onlineStatus},
            #{device.bindStatus},
            #{device.bindTime},
            #{device.enableStatus},
            #{device.workStatus},
            #{device.ip},
            #{device.speedConfig},
            #{device.version},
            #{device.location},
            #{device.status},
            #{device.hardVersion},
            #{device.communicationVersion},
            #{device.softVersion},
            #{device.birthTime},
            #{device.createTime},
            #{device.lastUpdateTime}
            )
        </foreach>
    </insert>

    <select id="selectById" parameterType="java.lang.Integer" resultType="com.huanke.iot.base.po.device.DevicePo">
        select
        *
        FROM
        <include refid="tableName"/>
        WHERE id = #{id} limit 1
    </select>

    <select id="selectByMac" parameterType="java.lang.String" resultType="com.huanke.iot.base.po.device.DevicePo">
        select
        *
        FROM
        <include refid="tableName"/>
        WHERE mac = #{mac} limit 1
    </select>

    <select id="selectBySaNo" parameterType="java.lang.String" resultType="com.huanke.iot.base.po.device.DevicePo">
        select
        *
        FROM
        <include refid="tableName"/>
        WHERE saNo = #{saNo} limit 1
    </select>


    <select id="selectList" resultType="com.huanke.iot.base.po.device.DevicePo">
        select * from
        <include refid="tableName"/>
        <where>
            1 = 1
            <if test="param.mac != null and param.mac != ''">
                AND mac = #{param.mac}

            </if>
            <if test="param.saNo != null and param.saNo != ''">
                AND saNo = #{param.saNo}
            </if>
            <if test="param.name != null  and param.name != ''  ">
                AND name like CONCAT('%',CONCAT(#{param.name},'%'))
            </if>
            <if test="param.onlineStatus != null">
                AND onlineStatus = #{param.onlineStatus}
            </if>
        </where>
        limit #{offset},#{limit}
    </select>

    <select id="selectCount" resultType="java.lang.Integer">
        select count(1) from
        <include refid="tableName"/>
        <where>
            <if test="param.mac != null and param.mac != ''">
                AND mac = #{param.mac}
            </if>
            <if test="param.saNo != null and param.saNo != ''">
                AND saNo = #{param.saNo}
            </if>
            <if test="param.name != null  and param.name != ''  ">
                AND name like CONCAT('%',CONCAT(#{param.name},'%'))
            </if>
            <if test="param.onlineStatus != null">
                AND onlineStatus = #{param.onlineStatus}
            </if>

        </where>
    </select>

    <select id="selectByDeviceId" parameterType="java.lang.String" resultType="com.huanke.iot.base.po.device.DevicePo">
        select
        *
        FROM
        <include refid="tableName"/>
        WHERE deviceId = #{deviceId} limit 1
    </select>

    <!--单条更新-->
    <update id="updateByDeviceId" parameterType="com.huanke.iot.base.po.device.DevicePo">

        update
        <include refid="tableName"/>
        <set>
            <if test="name != null">
                name = #{name},
            </if>
            <if test="deviceId != null">
                deviceId = #{deviceId},
            </if>
            <if test="devicelicence != null">
                devicelicence = #{devicelicence},
            </if>
            <if test="imei != null">
                imei = #{imei},
            </if>
            <if test="imsi != null">
                imsi = #{imsi},
            </if>
            <if test="saNo != null">
                saNo = #{saNo},
            </if>
            <if test="typeId != null">
                typeId = #{typeId},
            </if>
            <if test="modelId != null">
                modelId = #{modelId},
            </if>
            <if test="productId != null">
                productId = #{productId},
            </if>
            <if test="onlineStatus != null">
                onlineStatus = #{onlineStatus},
            </if>
            <if test="bindStatus != null">
                bindStatus = #{bindStatus},
            </if>
            <if test="bindTime != null">
                bindTime = #{bindTime},
            </if>
            <if test="enableStatus != null">
                enableStatus = #{enableStatus},
            </if>
            <if test="workStatus != null">
                workStatus = #{workStatus},
            </if>
            <if test="ip != null">
                ip = #{ip},
            </if>
            <if test="speedConfig != null">
                speedConfig = #{speedConfig},
            </if>
            <if test="version != null">
                version = #{version},
            </if>
            <if test="location != null">
                location = #{location},
            </if>
            <if test="lastUpdateTime != null">
                lastUpdateTime = #{lastUpdateTime},
            </if>
        </set>
        where
        1= 1
        <if test="id != null"> and id = #{id}</if>
        <if test="deviceId != null and deviceId != ''"> and deviceId = #{deviceId}</if>
    </update>

    <!--批量更新-->
    <update id="updateBatch" parameterType="java.util.List">
        update
        <include refid="tableName"/>
        <trim prefix="set" suffixOverrides=",">
            <trim prefix="name =case" suffix="end,">
                <foreach collection="list" item="device" index="index">
                    <if test="device.name !=null">
                        when id=#{device.id} then #{device.name}
                    </if>
                </foreach>
            </trim>
            <trim prefix="modelId =case" suffix="end,">
                <foreach collection="list" item="device" index="index">
                    <if test="device.modelId !=null">
                        when id=#{device.id} then #{device.modelId}
                    </if>
                </foreach>
            </trim>
            <trim prefix="productId =case" suffix="end,">
                <foreach collection="list" item="device" index="index">
                    <if test="device.productId !=null">
                        when id=#{device.id} then #{device.productId}
                    </if>
                </foreach>
            </trim>
            <trim prefix="deviceId =case" suffix="end,">
                <foreach collection="list" item="device" index="index">
                    <if test="device.deviceId !=null">
                        when id=#{device.id} then #{device.deviceId}
                    </if>
                </foreach>
            </trim>
            <trim prefix="devicelicence =case" suffix="end,">
                <foreach collection="list" item="device" index="index">
                    <if test="device.devicelicence !=null">
                        when id=#{device.id} then #{device.devicelicence}
                    </if>
                </foreach>
            </trim>
            <trim prefix="lastUpdateTime =case" suffix="end,">
                <foreach collection="list" item="device" index="index">
                    <if test="device.lastUpdateTime !=null">
                        when id=#{device.id} then #{device.lastUpdateTime}
                    </if>
                </foreach>
            </trim>
        </trim>
        where id in
        <foreach collection="list" index="index" item="item" separator="," open="(" close=")">
            #{item.id,jdbcType=BIGINT}
        </foreach>
    </update>


    <update id="updateStatus" parameterType="com.huanke.iot.base.po.device.DevicePo">

        update
        <include refid="tableName"/>
        <set>
            <if test="bindStatus != null">
                bindStatus = #{bindStatus},bindTime = sysdate
            </if>
            <if test="onlineStatus != null">
                onlineStatus = #{onlineStatus},
            </if>
            <if test="enableStatus != null">
                enableStatus = #{enableStatus},
            </if>
            <if test="workStatus != null">
                workStatus = #{workStatus},
            </if>
            lastUpdateTime = #{lastUpdateTime}
        </set>
        where
        deviceId = #{deviceId}
    </update>

    <update id="updateOnlyDeviceId" parameterType="com.huanke.iot.base.po.device.DevicePo">
        update  <include refid="tableName"/>  set deviceId = #{deviceId} where id = #{id}
    </update>
    <select id="selectAll" resultType="com.huanke.iot.base.po.device.DevicePo">
        select * from
        <include refid="tableName"/>
    </select>

    <!--单条删除-->
    <delete id="deleteDevice" parameterType="com.huanke.iot.base.po.device.DevicePo">
        delete from
        <include refid="tableName"/>
        <where>
            mac = #{mac}
        </where>
    </delete>

    <!--批量删除-->
    <delete id="deleteDeviceBatch" parameterType = "java.util.List">
        delete from
        <include refid="tableName"/>
        where id in
        <foreach collection="list" item="item" separator="," open="(" close=")">
            #{item.id,jdbcType=BIGINT}
        </foreach>
    </delete>

    <select id="getCustomerId" parameterType="com.huanke.iot.base.po.device.DevicePo" resultType="java.lang.Integer">
        select customerId
        from t_device_customer_relation
        where deviceId = #{deviceId}
    </select>

</mapper>